# 🔍 故障排查指南

## 问题：JSON解析失败，原始响应为空

### 可能的原因

1. **HTTP 301 重定向** - 导致响应为空
2. **PHP 文件执行出错但被抑制** - 没有输出任何内容
3. **文件编码问题** - BOM 或其他隐藏字符
4. **输出缓冲问题** - 内容被清除但没有新的输出

---

## 🔧 解决步骤

### 步骤1：测试最简化版本

访问：`https://你的域名/api/get_tutors_minimal.php`

**期望结果**：返回JSON格式的教员列表

如果这个可以工作，说明数据库连接正常，问题在于主文件的逻辑。

---

### 步骤2：测试调试版本

访问：`https://你的域名/api/debug_get_tutors.php`

这会显示每一步的执行状态，帮助你定位问题。

---

### 步骤3：检查 PHP 错误日志

在宝塔面板中：
1. 找到你的网站目录
2. 查看 `runtime/error.log` 或 `error_log` 文件
3. 查看是否有 PHP 错误信息

---

### 步骤4：检查文件权限

确保所有 PHP 文件权限为 `644`：
```bash
chmod 644 api/*.php
chmod 644 config/*.php
```

---

### 步骤5：检查 PHP 版本

在宝塔面板中确认 PHP 版本 >= 7.0

---

## 📝 常见问题

### 问题1：HTTP 301 重定向

**原因**：URL 末尾缺少斜杠或服务器重写规则

**解决**：
- 确保访问的URL是正确的：`api/get_tutors.php`（不带末尾斜杠）
- 检查 `.htaccess` 或 Nginx 配置是否有重定向规则

### 问题2：响应为空

**原因**：PHP 代码执行到一半就停止了

**解决**：
1. 使用 `debug_get_tutors.php` 查看在哪一步失败
2. 检查数据库连接是否正常
3. 检查表是否存在

### 问题3：JSON解析失败

**原因**：PHP 输出了非JSON内容（如警告、错误信息）

**解决**：
1. 确保所有 PHP 文件都没有 `?>` 标签后的空白
2. 确保 `error_reporting(0)` 和 `ini_set('display_errors', 0)` 已设置
3. 使用输出缓冲清理所有内容

---

## 🚀 快速修复

如果以上都不行，尝试以下步骤：

1. **备份现有文件**
2. **使用最简化版本**：将 `get_tutors_minimal.php` 的内容复制到 `get_tutors.php`
3. **测试是否工作**
4. **逐步添加功能**，找出问题所在

---

## 📞 需要帮助？

如果还是不行，请提供：

1. `api/debug_get_tutors.php` 的输出结果
2. `api/get_tutors_minimal.php` 的输出结果  
3. PHP 错误日志的内容
4. 宝塔面板中的 PHP 版本

