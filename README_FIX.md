# 🔧 网站修复指南

## ✅ 已修复的问题

1. **所有API文件** - 添加了全局错误处理和CORS支持
2. **JSON解析失败** - 修复了 `get_tutors.php` 的空响应问题
3. **数据库表缺失** - 提供了自动初始化脚本
4. **语法错误** - 修复了 `user_api.php` 的重复结束标签

---

## 🚀 部署步骤

### 第一步：上传文件到宝塔服务器

将所有修改后的文件上传到你的网站根目录。

### 第二步：测试PHP环境

访问：`https://你的域名/api/test_simple.php`

**期望结果**：显示 `{"status":"success","message":"PHP运行正常",...}`

如果失败，说明PHP环境有问题。

---

### 第三步：测试数据库连接

访问：`https://你的域名/api/test_db.php`

**期望结果**：显示数据库连接状态和表检查结果

---

### 第四步：初始化数据库（重要！）

访问：`https://你的域名/api/init_db.php`

**功能**：
- 自动创建所有必需的数据表
- 创建测试用户和测试教员数据

**期望结果**：显示 `{"status":"success","message":"数据库初始化完成",...}`

---

### 第五步：测试API接口

访问：`https://你的域名/api/get_tutors.php?page=1&limit=12`

**期望结果**：返回JSON格式的教员列表

```json
{
  "status": "success",
  "message": "获取成功",
  "data": [...],
  "pagination": {...}
}
```

---

## 🐛 常见问题排查

### 1. JSON解析失败，原始响应为空

**原因**：可能是PHP语法错误或表不存在

**解决方法**：
- 检查PHP语法：确保所有文件末尾只有一个 `?>`
- 运行初始化脚本：访问 `api/init_db.php`

### 2. 数据库连接失败

**原因**：`config/db.php` 中的账号密码不正确

**解决方法**：
1. 打开宝塔面板 → 数据库
2. 确认数据库名、用户名、密码
3. 修改 `config/db.php` 文件

### 3. 404错误

**原因**：文件路径不正确

**解决方法**：
- 确认API文件在 `api/` 目录下
- 确认 `config/db.php` 在 `config/` 目录下
- 检查文件权限（建议644）

---

## 📝 测试账号（初始化后可用）

### 学生端
- 手机号：`13800138000`
- 密码：`123456`

### 教员端
- 手机号：`13900139000`
- 密码：`123456`

---

## 🛠️ 调试技巧

### 查看PHP错误日志

在宝塔面板中：
1. 文件管理 → 找到你的网站目录
2. 查看 `runtime/error.log` 或 `error_log` 文件

### 浏览器开发者工具

1. 按 `F12` 打开开发者工具
2. 切换到 **Network（网络）** 标签
3. 刷新页面，查看API请求
4. 点击失败的请求，查看 **Response（响应）** 标签

---

## ✅ 验证清单

部署完成后，请确认：

- [ ] `api/test_simple.php` 可以访问
- [ ] `api/test_db.php` 显示数据库连接成功
- [ ] `api/init_db.php` 执行成功
- [ ] `api/get_tutors.php` 返回JSON数据
- [ ] 首页可以加载教员列表
- [ ] 可以登录（使用测试账号）

---

## 📞 如果还有问题

请提供以下信息：

1. **错误截图**：浏览器控制台的错误信息
2. **API响应**：失败的API请求的Response内容
3. **PHP版本**：在宝塔面板中查看
4. **数据库状态**：`api/test_db.php` 的返回结果

